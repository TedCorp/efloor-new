<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mall.web.mapper.admin.ProductMgrMapper">
	<!-- 공통 조건절 -->
	<sql id="searchCondition">
		<where>	
			<if test="schGbn != null and schGbn != ''">
				<if test='schGbn == "PD_NAME"'>
					<choose>
						<when test="schTxt_befList != null">
							<foreach collection="schTxt_befList" item="item" index="index" separator="" open="" close="">
					            AND PD_NAME LIKE '%' || #{item} || '%'
					        </foreach>
						</when>
					</choose>
				</if>	
				<if test='schGbn == "PD_CODE"'>
					<choose>
						<when test="schTxt_befList != null">
							<foreach collection="schTxt_befList" item="item" index="index" separator="" open="" close="">
					            AND PD_CODE LIKE '%' || #{item} || '%'
					        </foreach>
						</when>
					</choose>
				</if>
				<if test='schGbn == "PD_BARCD"'>
					<choose>
						<when test="schTxt_befList != null">
							<foreach collection="schTxt_befList" item="item" index="index" separator="" open="" close="">
					            AND PD_BARCD LIKE '%' || #{item} || '%'
					        </foreach>
						</when>
					</choose>
				</if>
			</if>
			<if test="ONDY_GUBN != null and ONDY_GUBN != ''">
				AND ONDY_GUBN = #{ONDY_GUBN}
			</if>
			<if test="salecon_sch != null and salecon_sch != ''">
				AND SALE_CON = #{salecon_sch}
			</if>
			AND DEL_YN = 'N'
		</where>  
	</sql>
	
	<!-- 상품 CNT -->
	<select id="count" parameterType="mall.web.domain.TB_PDINFOXM" resultType="int">
		SELECT COUNT(*)
		FROM (
			SELECT	  A.PD_CODE
						, A.SUPR_ID
						, A.PD_NAME
						, A.CAGO_ID
						, A.PD_PRICE
						<!-- , A.PDDC_GUBN
						, A.PDDC_VAL -->
						, A.MEMBER_PRICE
						, A.SVMN_GUBN
						, A.SVMN_VAL
						, A.INVEN_QTY
						, A.POS_NAME
						, A.PD_BARCD
						, A.STORE_CTR
						, A.PD_STD
						, A.DTB_DLINE
						, A.MAKE_COM
						, A.ORG_CT
						, A.SALE_CON
						, A.PD_DINFO
						, A.DLVREF_GUIDE
						, A.ATFL_ID
						, A.RPIMG_SEQ
						, A.ADC1_NAME
						, A.ADC2_NAME
						, A.ADC3_NAME
						, A.ADC4_NAME
						, A.ADC5_NAME
						, A.ADC1_VAL
						, A.ADC2_VAL
						, A.ADC3_VAL
						, A.ADC4_VAL
						, A.ADC5_VAL
						, A.PD_ICON
						, A.STD_UNIT
						, A.REGP_ID
						, A.REG_DTM
						, A.MODP_ID
						, A.MOD_DTM
						, A.TAX_GUBN
						, A.DEL_YN
						, A.DTL_ATFL_ID
						, A.DTL_USE_YN
                        , B.CAGO_ID_PATH
                        , B.CAGO_NM_PATH
                        , B.SORT_ORDR
                        , A.LIMIT_QTY
                        , A.ONDY_GUBN
                        , A.RETAIL_GUBN
                        , A.RETAIL_YN
                        , A.BOX_PDDC_GUBN
                        , A.BOX_PDDC_VAL
                        , A.INPUT_CNT
                        , A.PD_INTERFACE_YN
			FROM POLARBEAR.TB_PDINFOXM A
			LEFT OUTER JOIN
			(
				SELECT	CAGO_ID, CAGO_NAME, UPCAGO_ID, SORT_ORDR,
							SUBSTR(SYS_CONNECT_BY_PATH(CAGO_ID, '>'), 2) CAGO_ID_PATH,
							SUBSTR(SYS_CONNECT_BY_PATH(CAGO_NAME, '>'), 2) CAGO_NM_PATH
				FROM (SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE USE_YN = 'Y' AND DEL_YN = 'N')
				START WITH UPCAGO_ID IS NULL
				CONNECT BY PRIOR CAGO_ID = UPCAGO_ID
			) B
					ON A.CAGO_ID = B.CAGO_ID
			WHERE A.SUPR_ID= #{SUPR_ID}
			AND A.DEL_YN='N'
		) 
		<include refid="searchCondition"/>
	</select>


	<select id="countAdmin" parameterType="mall.web.domain.TB_PDINFOXM" resultType="int">
		SELECT COUNT(*)
		FROM (
			SELECT	  A.PD_CODE
						, A.SUPR_ID
						, A.PD_NAME
						, A.CAGO_ID
						, A.PD_PRICE
						, A.MEMBER_PRICE
						, A.SVMN_GUBN
						, A.SVMN_VAL
						, A.INVEN_QTY
						, A.POS_NAME
						, A.PD_BARCD
						, A.STORE_CTR
						, A.PD_STD
						, A.DTB_DLINE
						, A.MAKE_COM
						, A.ORG_CT
						, A.SALE_CON
						, A.PD_DINFO
						, A.DLVREF_GUIDE
						, A.ATFL_ID
						, A.RPIMG_SEQ
						, A.ADC1_NAME
						, A.ADC2_NAME
						, A.ADC3_NAME
						, A.ADC4_NAME
						, A.ADC5_NAME
						, A.ADC1_VAL
						, A.ADC2_VAL
						, A.ADC3_VAL
						, A.ADC4_VAL
						, A.ADC5_VAL
						, A.PD_ICON
						, A.STD_UNIT
						, A.REGP_ID
						, A.REG_DTM
						, A.MODP_ID
						, A.MOD_DTM
						, A.TAX_GUBN
						, A.DEL_YN
						, A.DTL_ATFL_ID
						, A.DTL_USE_YN
                        , B.CAGO_ID_PATH
                        , B.CAGO_NM_PATH
                        , B.SORT_ORDR
                        , A.LIMIT_QTY
                        , A.ONDY_GUBN
                        , A.RETAIL_GUBN
                        , A.RETAIL_YN
                        , A.BOX_PDDC_GUBN
                        , A.BOX_PDDC_VAL
                        , A.INPUT_CNT
                        , A.PD_INTERFACE_YN
			FROM POLARBEAR.TB_PDINFOXM A
			LEFT OUTER JOIN
			(
				SELECT	CAGO_ID, CAGO_NAME, UPCAGO_ID, SORT_ORDR,
							SUBSTR(SYS_CONNECT_BY_PATH(CAGO_ID, '>'), 2) CAGO_ID_PATH,
							SUBSTR(SYS_CONNECT_BY_PATH(CAGO_NAME, '>'), 2) CAGO_NM_PATH
				FROM (SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE USE_YN = 'Y' AND DEL_YN = 'N')
				START WITH UPCAGO_ID IS NULL
				CONNECT BY PRIOR CAGO_ID = UPCAGO_ID
			) B
			ON A.CAGO_ID = B.CAGO_ID
			WHERE A.DEL_YN='N'
			<if test='MODE == "searchPop" '> 
				AND A.SUPR_ID= #{SUPR_ID}
			</if>
			<if test='MODE == "extraPrd"'>
				AND A.SUPR_ID = #{SUPR_ID}
			</if>
		)
	
	</select>
	<!-- 상품 페이징 리스트 -->
	<select id="paginatedList" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDINFOXM">
		<include refid="default.pagerHeader"/>	
			SELECT *
			FROM (
				SELECT A.PD_CODE
						, A.SUPR_ID
						, (SELECT POLARBEAR.FC_GET_SUPRID_NM(A.SUPR_ID) FROM DUAL) AS SUPR_NAME
						, A.PD_NAME
						, A.CAGO_ID
						, (SELECT POLARBEAR.FC_GET_CAGOID_NM(A.CAGO_ID) FROM DUAL) AS CAGO_NAME
						, A.PD_PRICE
						, A.MEMBER_PRICE
						, A.SVMN_GUBN
						, A.SVMN_VAL
						, A.INVEN_QTY
						, A.POS_NAME
						, A.PD_BARCD
						, A.STORE_CTR
						, A.PD_STD
						, A.DTB_DLINE
						, A.MAKE_COM
						, A.ORG_CT
						, A.SALE_CON
						, A.PD_DINFO
						, A.DLVREF_GUIDE
						, A.ATFL_ID
						, A.RPIMG_SEQ
						, A.ADC1_NAME
						, A.ADC2_NAME
						, A.ADC3_NAME
						, A.ADC4_NAME
						, A.ADC5_NAME
						, A.ADC1_VAL
						, A.ADC2_VAL
						, A.ADC3_VAL
						, A.ADC4_VAL
						, A.ADC5_VAL
						, A.PD_ICON
						, A.STD_UNIT
						, A.REGP_ID
						, A.REG_DTM
						, A.MODP_ID
						, A.MOD_DTM
						, A.TAX_GUBN
						, A.DEL_YN
						, A.DTL_ATFL_ID
						, A.DTL_USE_YN
						, A.BUNDLE_CNT
						, A.KEEP_GUBN
						, A.PACKING_GUBN
						, A.KEEP_LOCATION
                        , B.CAGO_ID_PATH
                        , B.CAGO_NM_PATH
                        , B.SORT_ORDR
                        , A.LIMIT_QTY
                        , A.ONDY_GUBN
                        , A.RETAIL_GUBN
                        , A.RETAIL_YN
                        , CASE WHEN TO_DATE (TO_CHAR (A.MOD_DTM, 'YYYYMMDD'), 'YYYYMMDD') >= TO_DATE (TO_CHAR (SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')
								  THEN 'Y'
								  ELSE 'N'
			              END AS TODAY_CHANGE_YN
			            , A.BOX_PDDC_GUBN
			            , A.BOX_PDDC_VAL
			            , A.INPUT_CNT
			            , A.PD_INTERFACE_YN
                        , C.STFL_PATH
                        , C.STFL_NAME
                        , C.FILEPATH_FLAG
						, A.DLVY_GUBN
						, (SELECT POLARBEAR.FC_GET_COMCOD_NM(A.DLVY_GUBN) FROM DUAL) AS DLVY_GUBN_NM
						, A.PD_IWHUPRC
						, CASE WHEN MEMBER_PRICE = 0 OR MEMBER_PRICE IS NULL THEN PD_PRICE 
					  		   ELSE MEMBER_PRICE 
					   		   END AS PD_PRICE_RESULT
					    , A.IMGURL
				FROM POLARBEAR.TB_PDINFOXM A
				LEFT OUTER JOIN
				(
					SELECT	CAGO_ID, CAGO_NAME, UPCAGO_ID, SORT_ORDR,
				          		SUBSTR(SYS_CONNECT_BY_PATH(CAGO_ID, '>'), 2) CAGO_ID_PATH,
								SUBSTR(SYS_CONNECT_BY_PATH(CAGO_NAME, '>'), 2) CAGO_NM_PATH
					FROM (SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE USE_YN = 'Y' AND DEL_YN = 'N')
					START WITH UPCAGO_ID IS NULL
					CONNECT BY PRIOR CAGO_ID = UPCAGO_ID
				) B
					ON A.CAGO_ID = B.CAGO_ID
				LEFT OUTER JOIN POLARBEAR.TB_COATFLXD C
					ON A.ATFL_ID = C.ATFL_ID AND A.RPIMG_SEQ = C.ATFL_SEQ
					WHERE  A.SUPR_ID= #{SUPR_ID}		
				<if test="sortGubun != null and sortGubun != ''">
					<if test='sortGubun == "PD_NAME"'>
						<if test='sortOdr == "desc"'>
							ORDER BY A.PD_NAME desc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY A.PD_NAME asc
						</if>	
					</if>
					<if test='sortGubun == "CAGO_SORT"'>
						<if test='sortOdr == "desc"'>
							ORDER BY B.SORT_ORDR desc, A.PD_NAME asc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY B.SORT_ORDR asc, A.PD_NAME asc
						</if>
					</if>
					<if test='sortGubun == "REG_DTM"'>
						<if test='sortOdr == "desc"'>
							ORDER BY A.REG_DTM desc, A.PD_NAME asc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY A.REG_DTM asc, A.PD_NAME asc
						</if>
					</if>
					<if test='sortGubun == "MOD_DTM"'>
						<if test='sortOdr == "desc"'>
							ORDER BY A.MOD_DTM desc, A.PD_NAME asc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY A.MOD_DTM asc, A.PD_NAME asc
						</if>
					</if>
				</if>
				<if test="sortGubun == null or sortGubun == ''">
					ORDER BY A.MOD_DTM desc, A.PD_NAME asc
				</if>
			)
			<include refid="searchCondition"/>
		<include refid="default.pagerFooter"/>
	</select>
	
	<select id="paginatedListAdmin" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDINFOXM">
		<include refid="default.pagerHeader"/>	
			SELECT *
			FROM (
				SELECT A.PD_CODE
						, A.SUPR_ID
						, (SELECT POLARBEAR.FC_GET_SUPRID_NM(A.SUPR_ID) FROM DUAL) AS SUPR_NAME
						, A.PD_NAME
						, A.CAGO_ID
						, (SELECT POLARBEAR.FC_GET_CAGOID_NM(A.CAGO_ID) FROM DUAL) AS CAGO_NAME
						, A.PD_PRICE
						<!-- , A.PDDC_GUBN
						, A.PDDC_VAL -->
						, A.MEMBER_PRICE
						, A.SVMN_GUBN
						, A.SVMN_VAL
						, A.INVEN_QTY
						, A.POS_NAME
						, A.PD_BARCD
						, A.STORE_CTR
						, A.PD_STD
						, A.DTB_DLINE
						, A.MAKE_COM
						, A.ORG_CT
						, A.SALE_CON
						, A.PD_DINFO
						, A.DLVREF_GUIDE
						, A.ATFL_ID
						, A.RPIMG_SEQ
						, A.ADC1_NAME
						, A.ADC2_NAME
						, A.ADC3_NAME
						, A.ADC4_NAME
						, A.ADC5_NAME
						, A.ADC1_VAL
						, A.ADC2_VAL
						, A.ADC3_VAL
						, A.ADC4_VAL
						, A.ADC5_VAL
						, A.PD_ICON
						, A.STD_UNIT
						, A.REGP_ID
						, A.REG_DTM
						, A.MODP_ID
						, A.MOD_DTM
						, A.TAX_GUBN
						, A.DEL_YN
						, A.DTL_ATFL_ID
						, A.DTL_USE_YN
						, A.BUNDLE_CNT
						, A.KEEP_GUBN
						, A.PACKING_GUBN
						, A.KEEP_LOCATION
                        , B.CAGO_ID_PATH
                        , B.CAGO_NM_PATH
                        , B.SORT_ORDR
                        , A.LIMIT_QTY
                        , A.ONDY_GUBN
                        , A.RETAIL_GUBN
                        , A.RETAIL_YN
                        , CASE WHEN TO_DATE (TO_CHAR (A.MOD_DTM, 'YYYYMMDD'), 'YYYYMMDD') >= TO_DATE (TO_CHAR (SYSDATE, 'YYYYMMDD'), 'YYYYMMDD')
								  THEN 'Y'
								  ELSE 'N'
			              END AS TODAY_CHANGE_YN
			            , A.BOX_PDDC_GUBN
			            , A.BOX_PDDC_VAL
			            , A.INPUT_CNT
			            , A.PD_INTERFACE_YN
                        , C.STFL_PATH
                        , C.STFL_NAME
                        , C.FILEPATH_FLAG
						, A.DLVY_GUBN
						, (SELECT POLARBEAR.FC_GET_COMCOD_NM(A.DLVY_GUBN) FROM DUAL) AS DLVY_GUBN_NM
						, A.PD_IWHUPRC
						, A.IMGURL
				FROM POLARBEAR.TB_PDINFOXM A
				LEFT OUTER JOIN
				(
					SELECT	CAGO_ID, CAGO_NAME, UPCAGO_ID, SORT_ORDR,
				          		SUBSTR(SYS_CONNECT_BY_PATH(CAGO_ID, '>'), 2) CAGO_ID_PATH,
								SUBSTR(SYS_CONNECT_BY_PATH(CAGO_NAME, '>'), 2) CAGO_NM_PATH
					FROM (SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE USE_YN = 'Y' AND DEL_YN = 'N')
					START WITH UPCAGO_ID IS NULL
					CONNECT BY PRIOR CAGO_ID = UPCAGO_ID
				) B
					ON A.CAGO_ID = B.CAGO_ID
				LEFT OUTER JOIN POLARBEAR.TB_COATFLXD C
					ON A.ATFL_ID = C.ATFL_ID AND A.RPIMG_SEQ = C.ATFL_SEQ
				 <if test='MODE == "searchPop" '> 
					 WHERE A.SUPR_ID= #{SUPR_ID}
				 </if>
				<if test='MODE == "extraPrd"'>
				LEFT JOIN POLARBEAR.TB_PDOPTION D 
					ON A.PD_CODE = D.PD_CODE 
					WHERE D.PD_CODE IS NULL 
					AND A.SUPR_ID = #{SUPR_ID}
				</if>
				<if test='MODE == "getOption"'>
				LEFT JOIN POLARBEAR.TB_PDOPTION D 
					ON A.PD_CODE = D.PD_CODE 
					WHERE D.PD_CODE IS NOT NULL 
					AND D.DEL_YN = 'N'
					AND D.OPTION_NAME IS NOT NULL
					AND A.SUPR_ID = #{SUPR_ID}
				</if>
				<if test="sortGubun != null and sortGubun != ''">
					<if test='sortGubun == "PD_NAME"'>
						<if test='sortOdr == "desc"'>
							ORDER BY A.PD_NAME desc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY A.PD_NAME asc
						</if>	
					</if>
					<if test='sortGubun == "CAGO_SORT"'>
						<if test='sortOdr == "desc"'>
							ORDER BY B.SORT_ORDR desc, A.PD_NAME asc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY B.SORT_ORDR asc, A.PD_NAME asc
						</if>
					</if>
					<if test='sortGubun == "REG_DTM"'>
						<if test='sortOdr == "desc"'>
							ORDER BY A.REG_DTM desc, A.PD_NAME asc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY A.REG_DTM asc, A.PD_NAME asc
						</if>
					</if>
					<if test='sortGubun == "MOD_DTM"'>
						<if test='sortOdr == "desc"'>
							ORDER BY A.MOD_DTM desc, A.PD_NAME asc
						</if>	
						<if test='sortOdr == "asc"'>
							ORDER BY A.MOD_DTM asc, A.PD_NAME asc
						</if>
					</if>
				</if>
				<if test="sortGubun == null or sortGubun == ''">
					ORDER BY A.MOD_DTM desc, A.PD_NAME asc
				</if>
			)
			<include refid="searchCondition"/>
		<include refid="default.pagerFooter"/>
	</select>
	
	<select id="list" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDINFOXM">
		SELECT * FROM POLARBEAR.TB_PDINFOXM WHERE N_PD_CODE = #{N_PD_CODE} AND SUPR_ID = #{SUPR_ID}
	</select>
	
	<!-- 상품 상세 -->
	<select id="find" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDINFOXM">
		SELECT A.PD_CODE
			, A.SUPR_ID
			, (SELECT POLARBEAR.FC_GET_SUPRID_NM(A.SUPR_ID) FROM DUAL) AS SUPR_NAME
			, A.ADD_NUM
			, A.PD_NAME
			, A.CAGO_ID
			, (SELECT POLARBEAR.FC_GET_CAGOID_NM(B.CAGO_ID) FROM DUAL) AS CAGO_NAME
			, A.PD_PRICE
			, A.SVMN_GUBN
			, A.SVMN_VAL
			, A.INVEN_QTY
			, A.POS_NAME
			, A.PD_BARCD
			, A.STORE_CTR
			, A.PD_STD
			, A.DTB_DLINE
			, A.MAKE_COM
			, A.ORG_CT
			, A.SALE_CON
			, A.PD_DINFO
			, A.DLVREF_GUIDE
			, A.ATFL_ID
			, A.RPIMG_SEQ
			, A.ADC1_NAME
			, A.ADC2_NAME
			, A.ADC3_NAME
			, A.ADC4_NAME
			, A.ADC5_NAME
			, A.ADC1_VAL
			, A.ADC2_VAL
			, A.ADC3_VAL
			, A.ADC4_VAL
			, A.ADC5_VAL
			, A.PD_ICON
			, A.STD_UNIT
			, A.REGP_ID
			, A.REG_DTM
			, A.MODP_ID
			, A.MOD_DTM
			, A.TAX_GUBN
			, A.DTL_ATFL_ID
			, A.DTL_USE_YN
			, A.LINK_YN
			, A.BUNDLE_CNT
			, A.DLVR_INDI_YN
			, A.KEEP_GUBN
			, A.PACKING_GUBN
			, A.KEEP_LOCATION
            , B.CAGO_ID_PATH
            , B.CAGO_NM_PATH
            , B.SORT_ORDR
            , A.LIMIT_QTY
            , A.QNT_LIMT_USE
            , A.ONDY_GUBN
            , A.RETAIL_GUBN
            , A.RETAIL_YN
            , A.OPTION_GUBN
            , A.BOX_PDDC_GUBN
            , A.BOX_PDDC_VAL
            , A.INPUT_CNT
            , A.PD_INTERFACE_YN
          	, C.STFL_PATH
          	, C.STFL_NAME
          	, C.FILEPATH_FLAG
			, A.DLVY_GUBN
          	,(SELECT POLARBEAR.FC_GET_COMCOD_NM(A.DLVY_GUBN) FROM DUAL) AS DLVY_GUBN_NM
			, A.PD_IWHUPRC
			, A.MEMBER_PRICE
			, A.DLVY_SORT
		FROM POLARBEAR.TB_PDINFOXM A
		LEFT OUTER JOIN
		(
			SELECT CAGO_ID, CAGO_NAME, UPCAGO_ID, SORT_ORDR,
				       SUBSTR(SYS_CONNECT_BY_PATH(CAGO_ID, '>'), 2) CAGO_ID_PATH,
				       SUBSTR(SYS_CONNECT_BY_PATH(CAGO_NAME, '>'), 2) CAGO_NM_PATH
			FROM (SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE USE_YN = 'Y' AND DEL_YN = 'N')
			START WITH UPCAGO_ID IS NULL
			CONNECT BY PRIOR CAGO_ID = UPCAGO_ID
		) B
			ON A.CAGO_ID = B.CAGO_ID
		LEFT OUTER JOIN POLARBEAR.TB_COATFLXD C
			ON A.ATFL_ID = C.ATFL_ID AND A.RPIMG_SEQ = C.ATFL_SEQ        	
		WHERE 1=1
			AND A.PD_CODE = #{PD_CODE}
	</select>
	
	<!-- 상품 등록 -->
	<insert id="insert" parameterType="mall.web.domain.TB_PDINFOXM">
		<selectKey keyProperty="PD_CODE" resultType="string" order="BEFORE">
			<if test='PD_CODE_IN == "AUTO"'>
				SELECT #{CAGO_ID} || LPAD(nvl(max(substr(PD_CODE, #{CAGO_ID_LEN}, 4)), 0)+1, 4, '0')
				FROM POLARBEAR.TB_PDINFOXM
				WHERE PD_CODE LIKE #{CAGO_ID} || '%'   
			</if>
			<if test='PD_CODE_IN == "INPUT"'>
				SELECT #{PD_CODE} FROM DUAL   
			</if>
		</selectKey>
 
		INSERT INTO 
			POLARBEAR.TB_PDINFOXM (
				PD_CODE
				, SUPR_ID
				, PD_NAME
				, CAGO_ID
				, PD_PRICE
				, ADD_NUM
				, MEMBER_PRICE
				, SVMN_GUBN
				, SVMN_VAL
				, INVEN_QTY
				, POS_NAME
				, PD_BARCD
				, STORE_CTR
				, PD_STD
				, DTB_DLINE
				, MAKE_COM
				, ORG_CT
				, SALE_CON
				, PD_DINFO
				, DLVREF_GUIDE
				, ATFL_ID
				, RPIMG_SEQ
				, ADC1_NAME
				, ADC2_NAME
				, ADC3_NAME
				, ADC4_NAME
				, ADC5_NAME
				, ADC1_VAL
				, ADC2_VAL
				, ADC3_VAL
				, ADC4_VAL
				, ADC5_VAL
				, PD_ICON
				, STD_UNIT
				, REGP_ID
				, REG_DTM
				, MODP_ID
				, MOD_DTM
				, TAX_GUBN
				, DTL_ATFL_ID
				, DTL_USE_YN
				, LINK_YN
				, BUNDLE_CNT
				, DLVR_INDI_YN
				, KEEP_GUBN
				, PACKING_GUBN
				, KEEP_LOCATION
				, LIMIT_QTY
				, QNT_LIMT_USE
				, ONDY_GUBN
				, RETAIL_GUBN
                , RETAIL_YN
                , OPTION_GUBN
                , BOX_PDDC_GUBN
                , BOX_PDDC_VAL
                , INPUT_CNT
                , PD_INTERFACE_YN
                , PD_IWHUPRC
                , DLVY_SORT
			) VALUES (
				  TRIM(#{PD_CODE})
				, #{SUPR_ID}
				, #{PD_NAME}
				, #{CAGO_ID}
				, #{PD_PRICE}
				, #{ADD_NUM}
				, #{MEMBER_PRICE}
				, #{SVMN_GUBN}
				, #{SVMN_VAL}
				, #{INVEN_QTY}
				, #{POS_NAME}
				<if test='PD_BARCD_IN == "AUTO"'>
					, TRIM(#{PD_CODE})
				</if>
				<if test='PD_BARCD_IN == "INPUT"'>
					, TRIM(#{PD_BARCD})
				</if>
				, #{STORE_CTR}
				, #{PD_STD}
				, #{DTB_DLINE}
				, #{MAKE_COM}
				, #{ORG_CT}
				, #{SALE_CON}
				, #{PD_DINFO}
				, #{DLVREF_GUIDE}
				, #{ATFL_ID}
				, 1
				, #{ADC1_NAME}
				, #{ADC2_NAME}
				, #{ADC3_NAME}
				, #{ADC4_NAME}
				, #{ADC5_NAME}
				, #{ADC1_VAL}
				, #{ADC2_VAL}
				, #{ADC3_VAL}
				, #{ADC4_VAL}
				, #{ADC5_VAL}
				, #{PD_ICON}
				, #{STD_UNIT}
				, #{REGP_ID}
				, SYSDATE
				, #{REGP_ID}
				, SYSDATE
				, #{TAX_GUBN}
				, #{DTL_ATFL_ID}
				, #{DTL_USE_YN}
				, #{LINK_YN}
				, #{BUNDLE_CNT}
				, #{DLVR_INDI_YN}
				, #{KEEP_GUBN}
				, #{PACKING_GUBN}
				, #{KEEP_LOCATION}
				, #{LIMIT_QTY}
				, #{QNT_LIMT_USE}
				, #{ONDY_GUBN}
				, #{RETAIL_GUBN}
				, 'N'
				, #{OPTION_GUBN}
				, #{BOX_PDDC_GUBN}
				, #{BOX_PDDC_VAL}
				, #{INPUT_CNT}
				, #{PD_INTERFACE_YN}
				, #{PD_IWHUPRC}
				, #{DLVY_SORT}
			)
	</insert>
	
	<!-- 상품 등록 -->
	<insert id="insertLinkedObject" parameterType="mall.web.domain.TB_PDINFOXM">
		<selectKey keyProperty="PD_CODE" resultType="string" order="BEFORE">
				SELECT #{CAGO_ID} || LPAD(nvl(max(substr(PD_CODE, #{CAGO_ID_LEN}, 4)), 0)+1, 4, '0')
				FROM POLARBEAR.TB_PDINFOXM
				WHERE PD_CODE LIKE #{CAGO_ID} || '%'   
		</selectKey>
 
		INSERT INTO 
			POLARBEAR.TB_PDINFOXM (
				PD_CODE
				, SUPR_ID
				, PD_NAME
				, CAGO_ID
				, PD_PRICE
				, INVEN_QTY
				, SALE_CON
				, ATFL_ID
				, REGP_ID
				, REG_DTM
				, MODP_ID
				, MOD_DTM
                , RETAIL_YN
                , BOX_PDDC_GUBN
                , IMGURL
                , N_PD_CODE
                , PD_DINFO
			) VALUES (
				  TRIM(#{PD_CODE})
				, #{SUPR_ID}
				, #{PD_NAME}
				, #{CAGO_ID}
				, #{PD_PRICE}
				, #{INVEN_QTY}
				, #{SALE_CON}
				, #{ATFL_ID}
				, #{REGP_ID}
				, SYSDATE
				, #{REGP_ID}
				, SYSDATE
				, 'N'
				, #{BOX_PDDC_GUBN}
				, #{IMGURL}
				, #{N_PD_CODE}
				, #{PD_DINFO}
			)
	</insert>
	
	<!-- 상품 정보 수정 -->
	<update id="update" parameterType="mall.web.domain.TB_PDINFOXM">
		UPDATE 
			POLARBEAR.TB_PDINFOXM
		SET
			  MODP_ID = #{REGP_ID}
			, MOD_DTM = SYSDATE
			, PD_NAME = #{PD_NAME}        
			, CAGO_ID = #{CAGO_ID}        
			, PD_PRICE = #{PD_PRICE}  
			, ADD_NUM = #{ADD_NUM}
			, MEMBER_PRICE = #{MEMBER_PRICE}    
			, SVMN_GUBN = #{SVMN_GUBN}      
			, SVMN_VAL = #{SVMN_VAL}       
			, INVEN_QTY = #{INVEN_QTY}       
			, POS_NAME = #{POS_NAME}       
			, PD_BARCD = #{PD_BARCD}       
			, STORE_CTR = #{STORE_CTR}      
			, PD_STD = #{PD_STD}         
			, DTB_DLINE = #{DTB_DLINE}      
			, MAKE_COM = #{MAKE_COM}       
			, ORG_CT = #{ORG_CT}         
			, SALE_CON = #{SALE_CON}       
			, PD_DINFO = #{PD_DINFO}       
			, DLVREF_GUIDE = #{DLVREF_GUIDE}   
			, ATFL_ID = #{ATFL_ID}        
			, RPIMG_SEQ = #{RPIMG_SEQ}      
			, ADC1_NAME = #{ADC1_NAME}      
			, ADC2_NAME = #{ADC2_NAME}      
			, ADC3_NAME = #{ADC3_NAME}      
			, ADC4_NAME = #{ADC4_NAME}      
			, ADC5_NAME = #{ADC5_NAME}      
			, ADC1_VAL = #{ADC1_VAL}       
			, ADC2_VAL = #{ADC2_VAL}       
			, ADC3_VAL = #{ADC3_VAL}       
			, ADC4_VAL = #{ADC4_VAL}       
			, ADC5_VAL = #{ADC5_VAL}       
			, PD_ICON = #{PD_ICON}        
			, STD_UNIT = #{STD_UNIT}       
			, TAX_GUBN = #{TAX_GUBN}      
			, DTL_ATFL_ID = #{DTL_ATFL_ID} 
			, DTL_USE_YN  = #{DTL_USE_YN }
			, LINK_YN  = #{LINK_YN }
			, BUNDLE_CNT  = #{BUNDLE_CNT }
			, DLVR_INDI_YN  = #{DLVR_INDI_YN }
			, KEEP_GUBN = #{KEEP_GUBN}
			, PACKING_GUBN = #{PACKING_GUBN}
			, KEEP_LOCATION = #{KEEP_LOCATION}
			, LIMIT_QTY = #{LIMIT_QTY}
			, QNT_LIMT_USE = #{QNT_LIMT_USE}
			, ONDY_GUBN = #{ONDY_GUBN}
			, OPTION_GUBN = #{OPTION_GUBN}
			, BOX_PDDC_GUBN = #{BOX_PDDC_GUBN}
			, BOX_PDDC_VAL = #{BOX_PDDC_VAL}
			, RETAIL_YN = 'N'
			, INPUT_CNT = #{INPUT_CNT}
			, PD_INTERFACE_YN = #{PD_INTERFACE_YN}
			, PD_IWHUPRC = #{PD_IWHUPRC}
			, DLVY_SORT = #{DLVY_SORT}
		WHERE
			PD_CODE = #{PD_CODE}
	</update>
	
	<!-- 상품목록 엑셀 다운로드 -->
	<select id="excelList" parameterType="mall.web.domain.TB_PDINFOXM" resultType="HashMap">
		SELECT  A.PD_CODE         
               ,A.SUPR_ID
               ,A.PD_NAME
               ,A.CAGO_ID
               ,POLARBEAR.FC_GET_CAGOID_NM (A.CAGO_ID) AS CAGO_NM
               ,(SELECT DECODE (USE_YN,  'Y', '사용',  'N', '미사용')
                 FROM POLARBEAR.TB_PDCAGOXM
                 WHERE CAGO_ID = A.CAGO_ID) AS USE_YN
               ,A.PD_PRICE
              <!--  ,POLARBEAR.FC_GET_COMCOD_NM (A.PDDC_GUBN) AS PDDC_GUBN
               ,A.PDDC_VAL  -->
               ,A.MEMBER_PRICE
               ,A.SVMN_GUBN
               ,A.SVMN_VAL 
               ,A.INVEN_QTY
               ,A.POS_NAME
               ,A.PD_BARCD 
               ,A.STORE_CTR
               ,A.PD_STD
               ,A.DTB_DLINE
               ,A.MAKE_COM
               ,A.ORG_CT
               ,POLARBEAR.FC_GET_COMCOD_NM (A.SALE_CON) AS SALE_CON
               ,A.PD_DINFO
               ,A.DLVREF_GUIDE
               ,A.ATFL_ID
               ,A.RPIMG_SEQ
               ,A.ADC1_NAME
               ,A.ADC2_NAME
               ,A.ADC3_NAME
               ,A.ADC4_NAME
               ,A.ADC5_NAME
               ,A.ADC1_VAL
               ,A.ADC2_VAL
               ,A.ADC3_VAL
               ,A.ADC4_VAL
               ,A.ADC5_VAL
               ,A.PD_ICON 
               ,A.STD_UNIT
               ,A.REGP_ID
               ,A.REG_DTM
               ,A.MODP_ID
               ,A.MOD_DTM
               ,POLARBEAR.FC_GET_COMCOD_NM (A.TAX_GUBN) AS TAX_GUBN
               ,DECODE (A.DEL_YN,  'Y', '삭제',  'N', '미삭제') AS DEL_YN
               ,A.PD_MSTCD 
               ,A.OBTM
               ,A.DTL_ATFL_ID
               ,DECODE (A.DTL_USE_YN,  'Y', '사용',  'N', '미사용') AS DTL_USE_YN
               ,DECODE (A.LINK_YN,  'Y', '있음',  'N', '없음') AS LINK_YN
               ,A.BUNDLE_CNT
               ,DECODE (A.DLVR_INDI_YN,  'Y', '사용',  'N', '미사용') AS DLVR_INDI_YN 
               ,POLARBEAR.FC_GET_COMCOD_NM (A.KEEP_GUBN) AS KEEP_GUBN
               ,POLARBEAR.FC_GET_COMCOD_NM (A.PACKING_GUBN) AS PACKING_GUBN
               ,A.KEEP_LOCATION
               ,A.LIMIT_QTY
               ,POLARBEAR.FC_GET_COMCOD_NM (A.RETAIL_GUBN) AS RETAIL_GUBN
               ,A.INPUT_CNT
               ,DECODE (A.QNT_LIMT_USE,  'Y', '사용',  'N', '미사용') AS QNT_LIMT_USE
               ,POLARBEAR.FC_GET_COMCOD_NM (A.ONDY_GUBN) AS ONDY_GUBN
               ,DECODE (A.RETAIL_YN,  'Y', '사용',  'N', '미사용') AS RETAIL_YN
               ,POLARBEAR.FC_GET_COMCOD_NM (A.BOX_PDDC_GUBN) AS BOX_PDDC_GUBN
               ,A.BOX_PDDC_VAL               
               ,DECODE(A.OPTION_GUBN, '', '미사용', '사용') AS OPTION_GUBN
               ,CUT_UNIT
				, A.DLVY_GUBN
				,(SELECT POLARBEAR.FC_GET_COMCOD_NM(A.DLVY_GUBN) FROM DUAL) AS DLVY_GUBN_NM
				,A.PD_IWHUPRC
          FROM POLARBEAR.TB_PDINFOXM A
          LEFT OUTER JOIN
          (
	            SELECT A.PD_CODE,  LISTAGG(B.CUT_UNIT, ',') WITHIN GROUP (ORDER BY B.CUT_UNIT) AS CUT_UNIT
	          FROM POLARBEAR.TB_PDINFOXM A, POLARBEAR.TB_PDCUTXM B
	          WHERE A.PD_CODE = B.PD_CODE
	          GROUP BY A.PD_CODE
          ) B
         ON A.PD_CODE = B.PD_CODE
         WHERE A.DEL_YN = 'N'
		
	</select>
	
	
	<select id="proCutList" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDCUTXM">
		SELECT *
		FROM POLARBEAR.TB_PDCUTXM
		WHERE PD_CODE=#{PD_CODE}
		ORDER BY USE_YN DESC, SEQ
	</select>
	
	<!-- 세절방식 등록 -->
	<insert id="proCutInsert" parameterType="mall.web.domain.TB_PDCUTXM">
		<selectKey keyProperty="PD_CODE" resultType="string" order="BEFORE">
			<if test='PD_CODE_IN == "AUTO"'>
				SELECT #{CAGO_ID} || LPAD(nvl(max(substr(PD_CODE, #{CAGO_ID_LEN}, 4)), 0)+1, 4, '0')
				FROM POLARBEAR.TB_PDINFOXM
				WHERE PD_CODE LIKE #{CAGO_ID} || '%'   
			</if>
			<if test='PD_CODE_IN == null or PD_CODE_IN == "" or PD_CODE_IN == "INPUT"  '>
				SELECT #{PD_CODE} FROM DUAL   
			</if>
		</selectKey>

		MERGE INTO POLARBEAR.TB_PDCUTXM
		USING DUAL
			ON (PD_CODE=#{PD_CODE} AND SEQ = #{SEQ})
		WHEN MATCHED THEN
			UPDATE SET	MOD_DTM=SYSDATE,
						USE_YN=#{USE_YN}
		WHEN NOT MATCHED THEN
			INSERT (
              	SEQ,
              	PD_CODE,
              	CUT_UNIT,
              	REGP_ID,
              	REG_DTM,
              	MODP_ID,
              	MOD_DTM,
              	USE_YN
              ) VALUES (
              	(	SELECT DECODE(MAX(SEQ),NULL,1,MAX(SEQ)+1)
					FROM POLARBEAR.TB_PDCUTXM
					WHERE PD_CODE = #{PD_CODE}),
				#{PD_CODE},
				#{CUT_UNIT},
				#{REGP_ID},
				SYSDATE,
				#{REGP_ID},
				SYSDATE,
				#{USE_YN}
			)
	</insert>
	
	<!-- 상품코드 중복체크 -->
	<select id="pdCodeChk" parameterType="mall.web.domain.TB_PDINFOXM" resultType="int">
		SELECT COUNT(*) AS count
		FROM POLARBEAR.TB_PDINFOXM
		WHERE PD_CODE = #{PD_CODE}
	</select>
	
	<!-- 바코드 중복체크 -->
	<select id="pdBarCodeChk" parameterType="mall.web.domain.TB_PDINFOXM" resultType="int">
		SELECT COUNT(*) AS count
		FROM POLARBEAR.TB_PDINFOXM
		WHERE PD_BARCD = #{PD_BARCD}
	</select>
	
	<!-- 상품목록 선택상품 update  -->
	<update id="listUpdate" parameterType="mall.web.domain.TB_PDINFOXM">
		UPDATE 
			POLARBEAR.TB_PDINFOXM
		SET
			  MODP_ID = #{REGP_ID}
			, MOD_DTM = SYSDATE
			, PDDC_GUBN = #{PDDC_GUBN}      
			, SALE_CON = #{SALE_CON}
			<if test='PD_PRICE != ""'>
			, PD_PRICE = #{PD_PRICE}
			</if>
		WHERE
			PD_CODE = #{PD_CODE}
	</update>
	
	<!-- 상품가격 update -->
	<update id="excelUpdate_pdPrice" parameterType="mall.web.domain.TB_PDINFOXM">
		UPDATE 
			POLARBEAR.TB_PDINFOXM
		SET
			MODP_ID = #{MODP_ID}
	      , MOD_DTM = SYSDATE
		  , PD_PRICE = #{PD_PRICE}   
		WHERE
			PD_BARCD = #{PD_BARCD}
	</update>
	
	<!-- 상품 첨부파일 리스트 -->
	<select id="selectFileList" parameterType="mall.web.domain.TB_COATFLXD" resultType="mall.web.domain.TB_COATFLXD">
		SELECT ATFL_ID, ATFL_SEQ, STFL_PATH, STFL_NAME, ORFL_NAME, FILE_EXT, FILE_SIZE, DEL_YN
		FROM MALL.TB_COATFLXD
		WHERE ATFL_ID = #{ATFL_ID}
		ORDER BY ATFL_SEQ
	</select>
	
	<!-- 삭제상품 temp 백업 -->
	<insert id="tmpBackUp" parameterType="mall.web.domain.TB_PDINFOXM"> 
		INSERT INTO 
		POLARBEAR.TMP_PDINFOXM_DEL (
			  PD_CODE
			, SUPR_ID
			, PD_NAME
			, CAGO_ID
			, PD_PRICE
			, SVMN_GUBN
			, SVMN_VAL
			, INVEN_QTY
			, POS_NAME
			, PD_BARCD
			, STORE_CTR
			, PD_STD
			, DTB_DLINE
			, MAKE_COM
			, ORG_CT
			, SALE_CON
			, PD_DINFO
			, DLVREF_GUIDE
			, ATFL_ID
			, RPIMG_SEQ
			, ADC1_NAME
			, ADC2_NAME
			, ADC3_NAME
			, ADC4_NAME
			, ADC5_NAME
			, ADC1_VAL
			, ADC2_VAL
			, ADC3_VAL
			, ADC4_VAL
			, ADC5_VAL
			, PD_ICON
			, STD_UNIT
			, REGP_ID
			, REG_DTM
			, MODP_ID
			, MOD_DTM
			, TAX_GUBN
			, DEL_YN
			, PD_MSTCD
			, OBTM
			, DTL_ATFL_ID
			, DTL_USE_YN
			, LINK_YN
			, BUNDLE_CNT
			, DLVR_INDI_YN
			, KEEP_GUBN
			, PACKING_GUBN
			, KEEP_LOCATION
			, LIMIT_QTY
			, INPUT_CNT
			, RETAIL_GUBN
			, QNT_LIMT_USE
			, ONDY_GUBN
			, RETAIL_YN
			, OPTION_GUBN
			, BOX_PDDC_GUBN
			, BOX_PDDC_VAL
			, PD_INTERFACE_YN
			, PD_IWHUPRC ) 
		SELECT    PD_CODE
					, SUPR_ID
					, PD_NAME
					, CAGO_ID
					, PD_PRICE
					, SVMN_GUBN
					, SVMN_VAL
					, INVEN_QTY
					, POS_NAME
					, PD_BARCD
					, STORE_CTR
					, PD_STD
					, DTB_DLINE
					, MAKE_COM
					, ORG_CT
					, SALE_CON
					, PD_DINFO
					, DLVREF_GUIDE
					, ATFL_ID
					, RPIMG_SEQ
					, ADC1_NAME
					, ADC2_NAME
					, ADC3_NAME
					, ADC4_NAME
					, ADC5_NAME
					, ADC1_VAL
					, ADC2_VAL
					, ADC3_VAL
					, ADC4_VAL
					, ADC5_VAL
					, PD_ICON
					, STD_UNIT
					, REGP_ID
					, SYSDATE AS REG_DTM
					, MODP_ID
					, SYSDATE AS MOD_DTM
					, TAX_GUBN
					, 'Y' AS DEL_YN
					, PD_MSTCD
					, OBTM
					, DTL_ATFL_ID
					, DTL_USE_YN
					, LINK_YN
					, BUNDLE_CNT
					, DLVR_INDI_YN
					, KEEP_GUBN
					, PACKING_GUBN
					, KEEP_LOCATION
					, LIMIT_QTY
					, INPUT_CNT
					, RETAIL_GUBN
					, QNT_LIMT_USE
					, ONDY_GUBN
					, RETAIL_YN
					, OPTION_GUBN
					, BOX_PDDC_GUBN
					, BOX_PDDC_VAL
					, PD_INTERFACE_YN
					, PD_IWHUPRC
		FROM POLARBEAR.TB_PDINFOXM
		WHERE PD_CODE = #{PD_CODE}
	</insert>
	
	<!-- 상품 삭제 -->
	<update id="delete2" parameterType="mall.web.domain.TB_PDINFOXM">
		UPDATE 
			POLARBEAR.TB_PDINFOXM
		SET 
			  MODP_ID = #{REGP_ID}
			, MOD_DTM = SYSDATE
			, PD_BARCD = NULL
			, SALE_CON = 'SALE_CON_04'
		WHERE
			PD_CODE = #{PD_CODE}
	</update>

	<select id="getSuprList" parameterType="mall.web.domain.TB_SPINFOXM" resultType="mall.web.domain.TB_COATFLXD">
	   SELECT USE_YN
			, TEL_NUM
			, SVMN_USCON
			, SUPR_NAME
			, SUPR_ID
			, SCSS_YN
			, SBK_PROD
			, RPRS_NAME
			, RPR_MAIL
			, REGP_ID
			, REG_DTM
			, PS_COM
			, POST_NUM
			, MODP_ID
			, MOD_DTM
			, FAX_NUM
			, DTL_ADDR
			, DLVY_AMT
			, DLVREF_CONT
			, DLVA_FCON
			, BIZR_STYLE
			, BIZR_NUM
			, BIZR_EVENT
			, BASC_ADDR
			, APR_PROD
			, APD_PROD
	     FROM POLARBEAR.TB_SPINFOXM
		WHERE SCSS_YN = 'N' 
		AND SUPR_ID = #{SUPR_ID}
	</select>
	
	<select id="getSuprList2" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_SPINFOXM">
		SELECT * FROM POLARBEAR.TB_SPINFOXM WHERE SUPR_ID = #{SUPR_ID}
	</select>
	
	<!-- 상품 삭제 (사용안함) -->
	<update id="delete" parameterType="mall.web.domain.TB_PDINFOXM">
		UPDATE 
			POLARBEAR.TB_PDINFOXM
		SET 
			MODP_ID = #{MODP_ID}
			, MOD_DTM = #{MOD_DTM}
		WHERE
			PD_CODE = #{PD_CODE}
	</update>
	
	<!-- 상품 삭제 (사용안함) -->
	<update id="deletePrd" parameterType="mall.web.domain.TB_PDINFOXM">
		UPDATE 
			POLARBEAR.TB_PDINFOXM
		SET 
			  MODP_ID = #{REGP_ID}
			, MOD_DTM = SYSDATE
			, DEL_YN = 'Y'
		WHERE
			PD_CODE = #{PD_CODE}
	</update>
	
	<!-- 상품연계 테이블 조회 (사용안함) -->
	<select id="goodsMasterCount" parameterType="mall.web.domain.GOODS_MASTER" resultType="int">
			SELECT COUNT(*)
			  FROM (
					SELECT *
					FROM GOODS_MASTER A,
					       (
					        SELECT *
					          FROM (
					                SELECT LEVEL LVL, CAGO_ID, CAGO_NAME, UPCAGO_ID, SORT_ORDR,
					                       SUBSTR(SYS_CONNECT_BY_PATH(CAGO_ID, '>'), 2) CTGRY_CD_PATH,
					                       SUBSTR(SYS_CONNECT_BY_PATH(CAGO_NAME, '>'), 2) CTGRY_NM_PATH
					                FROM (SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE USE_YN = 'Y' AND DEL_YN = 'N')
					                START WITH UPCAGO_ID IS NULL
					                CONNECT BY PRIOR CAGO_ID = UPCAGO_ID
					               )
					          WHERE LVL = '4'
					       ) B
					 WHERE A.GUBUN4 = B.CAGO_NAME(+)
					<where>	
						<if test="schGbn != null and schGbn != ''">
							<if test='schGbn == "GOODS_NAME"'>
								<if test="schTxt != null and schTxt != ''">
								    AND GOODS_NAME LIKE '%' || #{schTxt} || '%'
								</if>	
							</if>	
							<if test='schGbn == "POS_NAME"'>
								<if test="schTxt != null and schTxt != ''">
								    AND POS_NAME LIKE '%' || #{schTxt} || '%'
								</if>	
							</if>
							<if test='schGbn == "GUBUN"'>
								<if test="schTxt != null and schTxt != ''">
								    AND ( GUBUN1 LIKE '%' || #{schTxt} || '%' OR GUBUN2 LIKE '%' || #{schTxt} || '%' OR GUBUN3 LIKE '%' || #{schTxt} || '%' OR GUBUN4 LIKE '%' || #{schTxt} || '%')
								</if>	
							</if>
						</if>
					</where>
			        )
	</select>
	
	<!-- 상품연계 테이블 조회 (사용안함) -->
	<select id="goodsMasterList" parameterType="mall.web.domain.GOODS_MASTER" resultType="mall.web.domain.GOODS_MASTER">
		<include refid="default.pagerHeader"/>	
			SELECT *
			  FROM (
					SELECT
						A.GOODS_CODE
						, A.GOODS_NAME
						, A.POS_NAME
						, A.STDARD
						, A.VOLUME
						, A.GOODS_BCODE
						, A.BOX_BCODE
						, A.GUBUN1
						, A.GUBUN2
						, A.GUBUN3
						, A.GUBUN4
						, B.CAGO_ID
						, B.CAGO_NAME
					FROM GOODS_MASTER A,
					       (
					        SELECT *
					          FROM (
					                SELECT LEVEL LVL, CAGO_ID, CAGO_NAME, UPCAGO_ID, SORT_ORDR,
					                       SUBSTR(SYS_CONNECT_BY_PATH(CAGO_ID, '>'), 2) CTGRY_CD_PATH,
					                       SUBSTR(SYS_CONNECT_BY_PATH(CAGO_NAME, '>'), 2) CTGRY_NM_PATH
					                FROM (SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE USE_YN = 'Y' AND DEL_YN = 'N')
					                START WITH UPCAGO_ID IS NULL
					                CONNECT BY PRIOR CAGO_ID = UPCAGO_ID
					               )
					          WHERE LVL = '4'
					       ) B
					 WHERE A.GUBUN4 = B.CAGO_NAME(+)
					<where>	
						<if test="schGbn != null and schGbn != ''">
							<if test='schGbn == "GOODS_NAME"'>
								<if test="schTxt != null and schTxt != ''">
								    AND A.GOODS_NAME LIKE '%' || #{schTxt} || '%'
								</if>	
							</if>	
							<if test='schGbn == "POS_NAME"'>
								<if test="schTxt != null and schTxt != ''">
								    AND A.POS_NAME LIKE '%' || #{schTxt} || '%'
								</if>	
							</if>
							<if test='schGbn == "GUBUN"'>
								<if test="schTxt != null and schTxt != ''">
								    AND ( A.GUBUN1 LIKE '%' || #{schTxt} || '%' OR A.GUBUN2 LIKE '%' || #{schTxt} || '%' OR A.GUBUN3 LIKE '%' || #{schTxt} || '%' OR A.GUBUN4 LIKE '%' || #{schTxt} || '%')
								</if>	
							</if>
						</if>
					</where>
			        )
		<include refid="default.pagerFooter"/>
	</select>
	<update id="optionDelete" parameterType="mall.web.domain.TB_PDOPTION" >
			DELETE 
			FROM POLARBEAR.TB_PDOPTION 
			WHERE PD_CODE =#{PD_CODE}
	</update>

	<insert id="optionInsert" parameterType="mall.web.domain.TB_PDOPTION"> 
		INSERT INTO POLARBEAR.TB_PDOPTION(PD_CODE
								   , OPTION_VALUE
								   , OPTION_NAME
								   , OPTION1_VALUE
								   , OPTION1_NAME
								   , QUANTITY
								   , SORT_ORDER
								   , PRICE
								   , OPTION2_NAME
								   , OPTION2_VALUE
								   , OPTION3_NAME
								   , OPTION3_VALUE
								   , DEL_YN
								   , SELL_YN
								   , MGR_CODE
								   , OPTION_ORIG_PRICE)
							VALUES(#{PD_CODE}
								   	, #{OPTION_VALUE}
								  	, #{OPTION_NAME}
								   	, #{OPTION1_VALUE}
								  	, #{OPTION1_NAME}
								 	, #{QUANTITY}
									, 0
									, #{PRICE}
									, #{OPTION2_NAME}
									, #{OPTION2_VALUE}
									, #{OPTION3_NAME}
									, #{OPTION3_VALUE}
									, #{DEL_YN}
									, #{SELL_YN}
									, #{MGR_CODE}
									, #{OPTION_ORIG_PRICE})
	</insert>
	
	<!--옵션리스트  -->
	<select id="getOptionList" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDOPTION">
		SELECT   PD_CODE
			   , OPTION1_VALUE
			   , OPTION1_NAME
			   , QUANTITY
			   , SORT_ORDER
			   , PRICE
			   , OPTION2_NAME
			   , OPTION2_VALUE
			   , OPTION3_NAME
			   , OPTION3_VALUE
			   , DEL_YN
			   , SELL_YN
			   , MGR_CODE
			   , OPTION_ORIG_PRICE
		FROM POLARBEAR.TB_PDOPTION 
		WHERE PD_CODE = #{PD_CODE}
		<!-- AND DEL_YN ='N' -->
		AND OPTION_NAME IS NULL 
	</select>
	
	<select id="getOptionTitle" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDOPTION">
		SELECT   PD_CODE
			   , OPTION_VALUE
			   , OPTION_NAME
		FROM POLARBEAR.TB_PDOPTION 
		WHERE PD_CODE = #{PD_CODE}
		AND DEL_YN = 'N'
		AND OPTION_NAME IS NOT NULL 
	</select>
	
	<select id="getExtraPrdlist" parameterType="List" resultType="mall.web.domain.TB_PDINFOXM">
		SELECT A.PD_CODE
		 , A.PD_NAME  
		  , A.PD_PRICE 
		FROM POLARBEAR.TB_PDINFOXM A
		LEFT JOIN POLARBEAR.TB_PDOPTION B 
		ON A.PD_CODE = B.PD_CODE 
		WHERE A.PD_CODE IN
		<foreach collection="list" item="pdcode" open="(" close=")" separator=",">
			#{pdcode}
		</foreach>
		AND B.PD_CODE IS NULL
	</select>
	
	<insert id="insertExtrprod"  parameterType="mall.web.domain.TB_EXTRPROD">
		INSERT INTO POLARBEAR.TB_EXTRPROD VALUES (#{PD_CODE},#{EXTRA_PD_CODE},'Y',SYSDATE)
	</insert>
	
	<select id="getSavedExtPrdList" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_EXTRPROD">
		SELECT * FROM POLARBEAR.TB_EXTRPROD A
		LEFT JOIN POLARBEAR.TB_PDINFOXM B
		ON A.EXTRA_PD_CODE =B.PD_CODE 
		WHERE A.PD_CODE =#{PD_CODE}
		AND A.USE_YN ='Y'
	</select>
	
	<update id="deleteExtrprod" parameterType="mall.web.domain.TB_PDINFOXM">
	UPDATE POLARBEAR.TB_EXTRPROD 
	SET USE_YN = 'N' 
	WHERE PD_CODE = #{PD_CODE} 
	AND EXTRA_PD_CODE = #{EXTRA_PD_CODE}
	AND USE_YN = 'Y'
	</update>
	
	<select id="checkExtrprod" parameterType="mall.web.domain.TB_PDINFOXM" resultType="int">
		SELECT COUNT(*) FROM POLARBEAR.TB_EXTRPROD 
		WHERE PD_CODE = #{PD_CODE} 
		AND EXTRA_PD_CODE = #{EXTRA_PD_CODE}
		AND USE_YN ='Y'
	</select>
	
	<select id="getUplodeResult" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDINFOXM">
		SELECT
			UPLOAD_STATE 
			,FAIL_MSG 
			,PD_CODE 
			,SALE_CON 
			,CAGO_ID 
			,PD_NAME
			,PD_PRICE 
			,INVEN_QTY 
		FROM POLARBEAR.TMP_PDINFOXM
		WHERE UPLOAD_CODE = #{UPLOAD_CODE}
	</select>
	
	<!-- 상품코드 가져오기 - 이유리 -->
	<select id="getProductCode" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDSHIPXM">
		SELECT 
			   PD_CODE
		  FROM
		 	   POLARBEAR.TB_PDINFOXM
		 WHERE 
			   CAGO_ID = #{CAGO_ID}
		   AND
		       PD_NAME = #{PD_NAME}
		   AND
		       PD_BARCD = #{PD_BARCD}
	</select>
	
	<!-- 배송정보 마스터 가져오기 - 이유리 -->
	<select id="getShipMaster" parameterType="mall.web.domain.TB_PDSHIPXM" resultType="mall.web.domain.TB_PDSHIPXM">
		SELECT 
			   PD_CODE	
			 , SUPR_ID	
			 , SHIP_CONFIG	
			 , DLVY_GUBN	
			 , SHIP_GUBN	
			 , GUBN_START	
			 , GUBN_END
			 , PD_WEIGHT	
			 , SHIP_WIDTH	
			 , SHIP_LENGTH	
			 , SHIP_HEIGHT	
			 , DLVY_AMT	
			 , RFND_DLVY_AMT
			 , AREA_DLVY_AMT
			 , TEMP_NUM
		  FROM
		 	   POLARBEAR.TB_PDSHIPXM 
		 WHERE 
			   PD_CODE = #{PD_CODE}
		 <if test='POP_Yn == "Y"'>
		   AND 
		   	   SHIP_CONFIG = #{SHIP_CONFIG}
		   AND 
		       SHIP_GUBN = #{SHIP_GUBN}
		 </if>
	</select>
	
	<!-- 배송정보 디테일 가져오기 - 이유리 -->
	<select id="getShipDetail" parameterType="mall.web.domain.TB_PDSHIPXD" resultType="mall.web.domain.TB_PDSHIPXD">
		SELECT 
			   PD_CODE	
			 , SUPR_ID
			 , SHIP_GUBN
			 , GUBN_START	
			 , GUBN_END
			 , DLVY_AMT	
			 , SHIP_SEQ
		  FROM
		 	   POLARBEAR.TB_PDSHIPXD
		 WHERE 
			   PD_CODE = #{PD_CODE}
	  ORDER BY
			   SHIP_SEQ ASC
	</select>
	
	<!-- 배송정보 마스터 업데이트 - 이유리 -->
	<update id="updateShipMaster" parameterType="mall.web.domain.TB_PDSHIPXM">
	MERGE INTO POLARBEAR.TB_PDSHIPXM
	USING DUAL
   	ON (PD_CODE = #{PD_CODE})
	WHEN MATCHED THEN
    UPDATE SET 
    	       SHIP_CONFIG = #{SHIP_CONFIG}
    	     , DLVY_GUBN = #{DLVY_GUBN}
    	     , SHIP_GUBN = #{SHIP_GUBN}
    	     , GUBN_START = #{GUBN_START}
    	     , PD_WEIGHT = #{PD_WEIGHT}
    	     , SHIP_WIDTH = #{SHIP_WIDTH}
    	     , SHIP_LENGTH = #{SHIP_LENGTH}
    	     , SHIP_HEIGHT = #{SHIP_HEIGHT}
    	     , DLVY_AMT = #{DLVY_AMT}
    	     , RFND_DLVY_AMT = #{RFND_DLVY_AMT}
    	     , AREA_DLVY_AMT = #{AREA_DLVY_AMT}
    	     , TEMP_NUM = #{TEMP_NUM}
	WHEN NOT MATCHED THEN
    INSERT (PD_CODE
    		, SUPR_ID
    		, SHIP_CONFIG
    		<if test="DLVY_GUBN != null and DLVY_GUBN != ''">
    		, DLVY_GUBN
    		</if>
    		<if test="SHIP_GUBN != null and SHIP_GUBN != ''">
    		, SHIP_GUBN
    		</if>
    		<if test="GUBN_START != null and GUBN_START != ''">
    	    , GUBN_START
    	    </if>
    		<if test="PD_WEIGHT != null and PD_WEIGHT != ''">
    		, PD_WEIGHT
    		</if>
    		<if test="SHIP_WIDTH != null and SHIP_WIDTH != ''">
    		, SHIP_WIDTH
    		</if>
    		<if test="SHIP_LENGTH != null and SHIP_LENGTH != ''">
    		, SHIP_LENGTH
    		</if>
    		<if test="SHIP_HEIGHT != null and SHIP_HEIGHT != ''">
    		, SHIP_HEIGHT
    		</if>
    		<if test="DLVY_AMT != null and DLVY_AMT != ''">
    		, DLVY_AMT
    		</if>
    		<if test="RFND_DLVY_AMT != null and RFND_DLVY_AMT != ''">
    		, RFND_DLVY_AMT
    		</if>
    		<if test="AREA_DLVY_AMT != null and AREA_DLVY_AMT != ''">
    		, AREA_DLVY_AMT
    		</if>
    		<if test="TEMP_NUM != null and TEMP_NUM != ''">
    	    , TEMP_NUM
    	     </if>
    		) 
    VALUES (#{PD_CODE}
    		, #{SUPR_ID}
    		, #{SHIP_CONFIG}
    		<if test="DLVY_GUBN != null and DLVY_GUBN != ''">
    		, #{DLVY_GUBN}
    		</if>
    		<if test="SHIP_GUBN != null and SHIP_GUBN != ''">
    		, #{SHIP_GUBN}
    		</if>
    		<if test="GUBN_START != null and GUBN_START != ''">
    	    , #{GUBN_START}
    	    </if>
    		<if test="PD_WEIGHT != null and PD_WEIGHT != ''">
    		, #{PD_WEIGHT}
    		</if>
    		<if test="SHIP_WIDTH != null and SHIP_WIDTH != ''">
    		, #{SHIP_WIDTH}
    		</if>
    		<if test="SHIP_LENGTH != null and SHIP_LENGTH != ''">
    		, #{SHIP_LENGTH}
    		</if>
    		<if test="SHIP_HEIGHT != null and SHIP_HEIGHT != ''">
    		, #{SHIP_HEIGHT}
    		</if>
    		<if test="DLVY_AMT != null and DLVY_AMT != ''">
    		, #{DLVY_AMT}
    		</if>
    		<if test="RFND_DLVY_AMT != null and RFND_DLVY_AMT != ''">
    		, #{RFND_DLVY_AMT}
    		</if>
    		<if test="AREA_DLVY_AMT != null and AREA_DLVY_AMT != ''">
    		, #{AREA_DLVY_AMT}
    		</if>
    		<if test="TEMP_NUM != null and TEMP_NUM != ''">
    	    , #{TEMP_NUM}
    	    </if>
    		)
	</update>
	
	<!-- 배송정보 디테일 삭제 - 이유리 -->
	<delete id="deleteShipDetail" parameterType="mall.web.domain.TB_PDSHIPXD"> 
		DELETE 
			   FROM POLARBEAR.TB_PDSHIPXD 
		 WHERE 
		       PD_CODE = #{PD_CODE}
		   AND
		       SUPR_ID = #{SUPR_ID}
	</delete>
	
	<!-- 배송정보 디테일 업데이트 - 이유리 -->
	<insert id="updateShipDetail" parameterType="mall.web.domain.TB_PDSHIPXD"> 
		INSERT INTO POLARBEAR.TB_PDSHIPXD (
		  PD_CODE
	    , SUPR_ID
	    , SHIP_GUBN
	    , GUBN_START
	    , GUBN_END
	    , DLVY_AMT
	    , SHIP_SEQ)
		VALUES(
		  #{PD_CODE}
	   	, #{SUPR_ID}
	   	, #{SHIP_GUBN}
	  	, #{GUBN_START}
	   	, #{GUBN_END}
	  	, #{DLVY_AMT}
	 	, #{SHIP_SEQ})
	</insert>
	
	<insert id="insertProductInfo" parameterType="mall.web.domain.TB_PDINFOXM"> 
		INSERT INTO POLARBEAR.TMP_PDINFOXM (
										PD_CODE
										,SUPR_ID
										,PD_NAME
										,CAGO_ID
										,PD_PRICE
										,INVEN_QTY
										,PD_BARCD
										,PD_STD
										,MAKE_COM
										,ORG_CT
										,SALE_CON
										,PD_DINFO
										,DLVREF_GUIDE
										,ATFL_ID
										,RPIMG_SEQ
										,PD_ICON
										,STD_UNIT
										,TAX_GUBN
										,DEL_YN
										,DTL_ATFL_ID
										,DTL_USE_YN
										,LINK_YN
										,BUNDLE_CNT
										,DLVR_INDI_YN
										,KEEP_GUBN
										,PACKING_GUBN
										,KEEP_LOCATION
										,LIMIT_QTY
										,INPUT_CNT
										,RETAIL_GUBN
										,QNT_LIMT_USE
										,RETAIL_YN
										,OPTION_GUBN
										,BOX_PDDC_GUBN
										,BOX_PDDC_VAL
										,DLVY_GUBN
										,PD_IWHUPRC
										,PRICE_POLICY
										,MEMBER_PRICE
										,UPLOAD_CODE
										,REGP_ID
										,REG_DTM 
										,MODP_ID 
										,MOD_DTM 
										,UPLOAD_CNT
										,ORFL_NAME
										)
									VALUES(
											<if test='PD_CODE == ""|| PD_CODE =! null'>
												(SELECT #{CAGO_ID} || LPAD(nvl(max(substr(PD_CODE, #{CAGO_ID_LEN}, 4)), 0)+1, 4, '0')
												FROM POLARBEAR.TMP_PDINFOXM
												WHERE PD_CODE LIKE #{CAGO_ID} || '%')   
											</if>
											,#{SUPR_ID}
											,#{PD_NAME}
											,#{CAGO_ID}
											,#{PD_PRICE}
											,#{INVEN_QTY}
											,#{PD_BARCD}
											,#{PD_STD}
											,#{MAKE_COM}
											,#{ORG_CT}
											,#{SALE_CON}
											,#{PD_DINFO}
											,#{DLVREF_GUIDE}
											,#{ATFL_ID}
											,#{RPIMG_SEQ}
											,#{PD_ICON}
											,#{STD_UNIT}
											,#{TAX_GUBN}
											,#{DEL_YN}
											,#{DTL_ATFL_ID}
											,#{DTL_USE_YN}
											,#{LINK_YN}
											,#{BUNDLE_CNT}
											,#{DLVR_INDI_YN}
											,#{KEEP_GUBN}
											,#{PACKING_GUBN}
											,#{KEEP_LOCATION}
											,#{LIMIT_QTY}
											,#{INPUT_CNT}
											,#{RETAIL_GUBN}
											,#{QNT_LIMT_USE}
											,#{RETAIL_YN}
											,#{OPTION_GUBN}
											,#{BOX_PDDC_GUBN}
											,#{BOX_PDDC_VAL}
											,#{DLVY_GUBN}
											,#{PD_IWHUPRC}
											,#{PRICE_POLICY}
											,#{MEMBER_PRICE}
											,#{UPLOAD_CODE}
											,'admin'
											,SYSDATE 
											,'admin' 
											,SYSDATE 
											,#{UPLOAD_CNT}
											,#{ORFL_NAME}
											)
	</insert>
	
	<select id="getUploadCode" resultType="string">
		SELECT LPAD(UP_CODE_SEQ.NEXTVAL,8,'0') FROM dual
	</select>
	<resultMap id="boardMap" type="hashmap" />

	 <select id="callValidChk" statementType="CALLABLE" parameterType="hashmap">
	  { 
	  	CALL PROCUCT_VALIDATE_CHK( #{UPLOAD_CODE}, 
	  					#{updateCnt, mode=OUT, jdbcType=VARCHAR, javaType=string, resultMap=boardMap} ) 
	  } 
	  </select>

<!-- 템플릿 마스터 리스트 가져오기 - 이유리 -->
	<select id="getTempMasterList" parameterType="mall.web.domain.TB_SHIPTEXM" resultType="mall.web.domain.TB_SHIPTEXM">
		SELECT 
			   TEMP_NUM
			 , TEMP_NAME
			 , SUPR_ID
			 , DLVY_GUBN
			 , SHIP_GUBN
			 , REG_DATE
		  FROM
		 	   POLARBEAR.TB_SHIPTEXM
		 WHERE  
		   	   SUPR_ID = #{SUPR_ID}
	  ORDER BY
			   REG_DATE DESC
	</select>
	
	<!-- 템플릿 마스터 가져오기 - 이유리 -->
	<select id="getTempMaster" parameterType="mall.web.domain.TB_SHIPTEXM" resultType="mall.web.domain.TB_SHIPTEXM">
		SELECT 
			   TEMP_NUM
			 , TEMP_NAME
			 , SUPR_ID
			 , DLVY_GUBN
			 , SHIP_GUBN
			 , GUBN_START
			 , GUBN_END
			 , DLVY_AMT
			 , RFND_DLVY_AMT
			 , REG_DATE
		  FROM
		 	   POLARBEAR.TB_SHIPTEXM
		 WHERE  
		   	   SUPR_ID = #{SUPR_ID}
		   <if test="TEMP_NUM != null and TEMP_NUM != ''">
		   AND
		   	   TEMP_NUM = #{TEMP_NUM}
		   </if>
		   <if test="TEMP_NAME != null and TEMP_NAME != ''">
	  	   AND
			   TEMP_NAME = #{TEMP_NAME}
		   </if>
		   AND
		   	   ROWNUM = 1
	  ORDER BY
			   REG_DATE DESC
	</select>
	
	<!-- 템플릿 마스터 가져오기 - 이유리 -->
	<select id="getTempDetail" parameterType="mall.web.domain.TB_SHIPTEXD" resultType="mall.web.domain.TB_SHIPTEXD">
		SELECT 
			   TEMP_NUM
			 , SHIP_GUBN
			 , GUBN_START
			 , GUBN_END
			 , DLVY_AMT
			 , TEMP_SEQ
		  FROM
		 	   POLARBEAR.TB_SHIPTEXD
		 WHERE  
		   	   TEMP_NUM = #{TEMP_NUM}
	  ORDER BY
			   TEMP_SEQ ASC
	</select>
	
	<!-- 템플릿 마스터 인서트 - 이유리 -->
	<insert id="insertTempMaster" parameterType="mall.web.domain.TB_SHIPTEXM">
	<selectKey keyProperty="TEMP_NUM" resultType="String" order="BEFORE">
	SELECT LPAD(SEQ_TB_SHIPTEXM.NEXTVAL,13,0) FROM DUAL
	</selectKey>
    INSERT INTO POLARBEAR.TB_SHIPTEXM (
    		  TEMP_NUM
    		, TEMP_NAME
    		, SUPR_ID
    		, DLVY_GUBN
    		, SHIP_GUBN
    		<if test="GUBN_START != null and GUBN_START != ''">
    	    , GUBN_START
    	    </if>
    	    <if test="DLVY_AMT != null and DLVY_AMT != ''">
    		, DLVY_AMT
    		</if>
    		, RFND_DLVY_AMT
    		, REG_DATE
    		) 
    VALUES (#{TEMP_NUM}
    		, #{TEMP_NAME}
    		, #{SUPR_ID}
    		, #{DLVY_GUBN}
    		, #{SHIP_GUBN}
    		<if test="GUBN_START != null and GUBN_START != ''">
    	    , #{GUBN_START}
    	    </if>
    	    <if test="DLVY_AMT != null and DLVY_AMT != ''">
    		, #{DLVY_AMT}
    		</if>
    		, #{RFND_DLVY_AMT}
    		, SYSDATE
    		)
	</insert>
	
	<!-- 템플릿 마스터 업데이트 - 이유리 -->
	<update id="updateTempMaster" parameterType="mall.web.domain.TB_SHIPTEXM">
   UPDATE POLARBEAR.TB_SHIPTEXM
   	  SET 
		  TEMP_NAME = #{TEMP_NAME}
		, DLVY_GUBN = #{DLVY_GUBN}
		, SHIP_GUBN = #{SHIP_GUBN}
		<if test="GUBN_START != null and GUBN_START != ''">
		, GUBN_START = #{GUBN_START}
		</if>
		<if test="DLVY_AMT != null and DLVY_AMT != ''">
		, DLVY_AMT = #{DLVY_AMT}
		</if>
		, RFND_DLVY_AMT = #{RFND_DLVY_AMT}
   WHERE
   		 TEMP_NUM = #{TEMP_NUM}
	</update>
	
	<!-- 템플릿 마스터 삭제 - 이유리 -->
	<delete id="deleteTempMaster" parameterType="mall.web.domain.TB_SHIPTEXM"> 
		DELETE 
			   FROM POLARBEAR.TB_SHIPTEXM
		 WHERE 
		       TEMP_NUM = #{TEMP_NUM}
		   AND
		   	   SUPR_ID = #{SUPR_ID}
	</delete>
	
	<!-- 템플릿 디테일 삭제 - 이유리 -->
	<delete id="deleteTempDetail" parameterType="mall.web.domain.TB_SHIPTEXD"> 
		DELETE 
			   FROM POLARBEAR.TB_SHIPTEXD
		 WHERE 
		       TEMP_NUM = #{TEMP_NUM}
	</delete>
	
	<!-- 템플릿 디테일 업데이트 - 이유리 -->
	<insert id="updateTempDetail" parameterType="mall.web.domain.TB_SHIPTEXD"> 
		INSERT INTO POLARBEAR.TB_SHIPTEXD (
		  TEMP_NUM
	    , SHIP_GUBN
	    <if test="GUBN_START != null and GUBN_START != ''">
	    , GUBN_START
	    </if>
	    <if test="GUBN_END != null and GUBN_END != ''">
	    , GUBN_END
	    </if>
	    , DLVY_AMT
	    , TEMP_SEQ)
		VALUES(
		  #{TEMP_NUM}
	   	, #{SHIP_GUBN}
	   	<if test="GUBN_START != null and GUBN_START != ''">
	  	, #{GUBN_START}
	  	</if>
	  	<if test="GUBN_END != null and GUBN_END != ''">
	   	, #{GUBN_END}
	   	</if>
	  	, #{DLVY_AMT}
	 	, #{TEMP_SEQ})
	</insert>
	
	<!-- 조합원 배송비 가져오기 - 이유리 -->
	<select id="getSuprInfo" parameterType="mall.web.domain.TB_SPINFOXM" resultType="mall.web.domain.TB_SPINFOXM">
		SELECT 
			   DLVY_AMT
			 , DLVA_FCON
		  FROM 
			   POLARBEAR.TB_SPINFOXM
		 WHERE 
		       SUPR_ID = #{SUPR_ID}
	</select>
	
	<!-- 조합원코드 가져오기 - 이유리 -->
	<select id="selectSuprCode" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_PDINFOXM">
		SELECT 
			   SUPR_ID
		  FROM 
			   POLARBEAR.TB_PDINFOXM
		 WHERE 
		       PD_CODE = #{PD_CODE}
	</select>
	
	<!-- 조합원 배송비 업데이트 - 이유리 -->
	<update id="updateSuprInfo" parameterType="mall.web.domain.TB_PDSHIPXM">
	   UPDATE POLARBEAR.TB_SPINFOXM
	   	  SET 
			  DLVY_AMT = #{DLVY_AMT}
			, DLVA_FCON = #{GUBN_START}
	    WHERE
	   		 SUPR_ID = #{SUPR_ID}
	</update>
	
	<select id="getDeliveryInfo" parameterType="mall.web.domain.TB_PDINFOXM" resultType="mall.web.domain.TB_DELIVERY_ADDR">
		SELECT A.ADD_NUM,
	    	   B.COM_PN,
	     	  B.COM_BADR,
	     	  B.COM_DADR
		FROM POLARBEAR.TB_PDINFOXM A, POLARBEAR.TB_DELIVERY_ADDR B 
		WHERE A.ADD_NUM =B.ADD_NUM 
		AND A.ADD_NUM =#{ADD_NUM}
		AND A.PD_CODE=#{PD_CODE}
	</select>
	
	<!-- 0이 아니라면 option가격도 변동 -->
	<select id="countOriginPrice" parameterType="mall.web.domain.TB_PDINFOXM" resultType="int">
		SELECT 
			COUNT(*)
		FROM
			(SELECT A.OPTION_ORIG_PRICE ,
			  		A.MGR_CODE,
 				   B.PD_PRICE,
				   B.PD_CODE 
			FROM POLARBEAR.TB_PDOPTION A, POLARBEAR.TB_PDINFOXM B
			WHERE A.MGR_CODE =B.PD_CODE 
			AND A.OPTION_ORIG_PRICE !=B.PD_PRICE 
			AND B.PD_CODE =#{PD_CODE})
	</select>
	
	<update id="updateOrignPrice" parameterType="mall.web.domain.TB_PDINFOXM" >
		 UPDATE POLARBEAR.TB_PDOPTION
	   	  SET 
			  OPTION_ORIG_PRICE = #{PD_PRICE}
	    WHERE
	   		 MGR_CODE = #{PD_CODE}
	</update>
	
	<update id="updateOptionPrice" parameterType="mall.web.domain.TB_PDINFOXM">
	UPDATE POLARBEAR.TB_PDOPTION A
	   	  SET PRICE = (SELECT A.OPTION_ORIG_PRICE- B.PD_PRICE
	   	  				FROM POLARBEAR.TB_PDINFOXM B
	   	  				WHERE A.PD_CODE = B.PD_CODE)
		WHERE A.MGR_CODE IS NOT NULL
		AND A.MGR_CODE =#{PD_CODE}	
	</update>
	
	<update id="optionUpdate" parameterType="mall.web.domain.TB_PDOPTION" >
		UPDATE POLARBEAR.TB_PDOPTION A
	   	  SET A.PRICE = (SELECT A.OPTION_ORIG_PRICE-B.PD_PRICE
	   	  					FROM POLARBEAR.TB_PDINFOXM B
						WHERE A.PD_CODE =B.PD_CODE )
		WHERE A.MGR_CODE =#{MGR_CODE}
		AND A.PD_CODE =#{PD_CODE}
	</update>
	
	
	<insert id="insertPrdData" parameterType="mall.web.domain.TB_PDINFOXM">
	INSERT INTO POLARBEAR.TB_PDINFOXM (
							PD_CODE
							,SUPR_ID
							,PD_NAME
							,CAGO_ID
							,PD_PRICE
							,INVEN_QTY
							,PD_BARCD
							,PD_STD
							,MAKE_COM
							,ORG_CT
							,SALE_CON
							,PD_DINFO
							,DLVREF_GUIDE
							,ATFL_ID
							,RPIMG_SEQ
							,PD_ICON
							,STD_UNIT
							,TAX_GUBN
							,DEL_YN
							,DTL_ATFL_ID
							,DTL_USE_YN
							,LINK_YN
							,BUNDLE_CNT
							,DLVR_INDI_YN
							,KEEP_GUBN
							,PACKING_GUBN
							,KEEP_LOCATION
							,LIMIT_QTY
							,INPUT_CNT
							,RETAIL_GUBN
							,QNT_LIMT_USE
							,RETAIL_YN
							,OPTION_GUBN
							,BOX_PDDC_GUBN
							,BOX_PDDC_VAL
							,DLVY_GUBN
							,PD_IWHUPRC
							,PRICE_POLICY
							,MEMBER_PRICE
							,REGP_ID
							,REG_DTM 
							,MODP_ID 
							,MOD_DTM 
							
)SELECT
							 A.PD_CODE	
							,A.SUPR_ID
							,A.PD_NAME
							,A.CAGO_ID
							,A.PD_PRICE
							,A.INVEN_QTY
							,A.PD_BARCD
							,A.PD_STD
							,A.MAKE_COM
							,A.ORG_CT
							,A.SALE_CON
							,A.PD_DINFO
							,A.DLVREF_GUIDE
							,C.ATFL_ID
							,A.RPIMG_SEQ
							,A.PD_ICON
							,A.STD_UNIT
							,A.TAX_GUBN
							,A.DEL_YN
							,C.ATFL_ID || '_DTL'
							,A.DTL_USE_YN
							,A.LINK_YN
							,A.BUNDLE_CNT
							,A.DLVR_INDI_YN
							,A.KEEP_GUBN
							,A.PACKING_GUBN
							,A.KEEP_LOCATION
							,A.LIMIT_QTY
							,A.INPUT_CNT
							,A.RETAIL_GUBN
							,A.QNT_LIMT_USE
							,A.RETAIL_YN
							,A.OPTION_GUBN
							,A.BOX_PDDC_GUBN
							,A.BOX_PDDC_VAL
							,A.DLVY_GUBN
							,A.PD_IWHUPRC
							,A.PRICE_POLICY
							,A.MEMBER_PRICE
							,A.REGP_ID
							,A.REG_DTM 
							,A.MODP_ID 
							,A.MOD_DTM 
		FROM POLARBEAR.TMP_PDINFOXM A
	JOIN(
		SELECT A.*,B.ORFL_NAME FROM POLARBEAR.TB_COATFLXM A
		JOIN POLARBEAR.TB_COATFLXD B
		ON A.ATFL_ID =B.ATFL_ID
		WHERE A.UPLOAD_CODE =#{UPLOAD_CODE}  
	) C
	ON A.ORFL_NAME = C.ORFL_NAME
	WHERE A.UPLOAD_CODE =#{UPLOAD_CODE}
	AND A.FAIL_MSG IS NULL
	
	</insert> 
	<delete id="resetTmpPdinfoxm" parameterType="mall.web.domain.TB_PDINFOXM">
		DELETE FROM POLARBEAR.TMP_PDINFOXM WHERE UPLOAD_CODE = #{UPLOAD_CODE}
	</delete>
	
	<select id="cagoSearch" parameterType="mall.web.domain.TB_PDCAGOXM" resultType="mall.web.domain.TB_PDCAGOXM">
		SELECT * FROM POLARBEAR.TB_PDCAGOXM WHERE CAGO_NAME LIKE '%'||#{CAGO_NAME}||'%'
	</select>
	
	
	<update id="setDetailimg"  parameterType="mall.web.domain.TB_COATFLXD">
		UPDATE POLARBEAR.TB_COATFLXD SET ATFL_SEQ = #{ATFL_SEQ}
							 , ATFL_ID = (SELECT  ATFL_ID FROM POLARBEAR.TB_COATFLXD WHERE ORFL_NAME =#{ORFL_NAME} AND UPLOAD_CODE = #{UPLOAD_CODE})|| '_DTL' WHERE UPLOAD_CODE = #{UPLOAD_CODE} AND ORFL_NAME = #{STFL_NAME} 
	</update>
	
	<insert id="detailMasterInsert" parameterType="mall.web.domain.TB_COATFLXD">
	
		INSERT INTO POLARBEAR.TB_COATFLXM values((SELECT  ATFL_ID FROM POLARBEAR.TB_COATFLXD WHERE ORFL_NAME = #{ORFL_NAME} AND UPLOAD_CODE = #{UPLOAD_CODE}) || '_DTL',#{REGP_ID},SYSDATE,#{REGP_ID},SYSDATE,#{UPLOAD_CODE})
	
	</insert>
	
	<select id="linkDuplicateChk" parameterType="mall.web.domain.TB_PDINFOXM" resultType="int">
		SELECT COUNT(PD_CODE)
		FROM POLARBEAR.TB_PDINFOXM
		WHERE N_PD_CODE = #{N_PD_CODE}
		AND SUPR_ID = #{SUPR_ID}
	</select>
	
	<select id="selectByNpdcode" parameterType="mall.web.domain.TB_PDINFOXM" resultType="String">
		SELECT PD_CODE 
		FROM POLARBEAR.TB_PDINFOXM 
		WHERE N_PD_CODE = #{N_PD_CODE}
		AND SUPR_ID = #{SUPR_ID}
	</select>
	
	<insert id="insertShip" parameterType="mall.web.domain.TB_PDSHIPXM">
		INSERT INTO
		POLARBEAR.TB_PDSHIPXM
		(
			PD_CODE
			,SUPR_ID
			,SHIP_CONFIG
			,DLVY_GUBN
			,SHIP_GUBN
			,GUBN_START
			,DLVY_AMT
		) VALUES (
			#{PD_CODE}
			,#{SUPR_ID}
			,#{SHIP_CONFIG}
			,#{DLVY_GUBN}
			,#{SHIP_GUBN}
			,#{GUBN_START}
			,#{DLVY_AMT}
		)
	</insert>

</mapper>
 